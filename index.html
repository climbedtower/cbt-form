<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>scrapboxCBT</title>
  <!-- Semantic UI CSS -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
  />
</head>
<body>
  <div class="ui container" style="padding: 2em 0;">
    <form id="cbt-form" class="ui form segment">
      <h4 class="ui dividing header">CBTログ入力</h4>

      <!-- 出来事 -->
      <div class="field">
        <label>出来事（外部で起きた具体的な事象）</label>
        <textarea
          name="event"
          rows="3"
          placeholder="出来事を入力"
        ></textarea>
      </div>

      <!-- 自動思考 -->
      <div class="field">
        <label>自動思考（その瞬間に浮かんだ考え／言葉）</label>
        <textarea
          name="thought"
          rows="2"
          placeholder="自動思考を入力"
        ></textarea>
      </div>

      <!-- 感情チェック -->
      <div class="inline fields">
        <label class="six wide field">感情（複数選択可）</label>
        <div class="ten wide field">
          <div class="ui twelve grid">
            <div class="row">
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e1" name="emotion" value="[||制作完了]" />
                  <label for="e1">制作完了</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e2" name="emotion" value="[||原点回帰]" />
                  <label for="e2">原点回帰</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e3" name="emotion" value="[||達成感]" />
                  <label for="e3">達成感</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e4" name="emotion" value="[||感謝]" />
                  <label for="e4">感謝</label>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e5" name="emotion" value="[||安心]" />
                  <label for="e5">安心</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e6" name="emotion" value="[||過集中]" />
                  <label for="e6">過集中</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e7" name="emotion" value="[::回避行動]" />
                  <label for="e7">回避行動</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e8" name="emotion" value="[::罪悪感]" />
                  <label for="e8">罪悪感</label>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e9" name="emotion" value="[::対人プレッシャー]" />
                  <label for="e9">対人プレッシャー</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e10" name="emotion" value="[::フリーズ]" />
                  <label for="e10">フリーズ</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e11" name="emotion" value="[::吸収期]" />
                  <label for="e11">吸収期</label>
                </div>
              </div>
              <div class="four wide column">
                <div class="ui checkbox">
                  <input type="checkbox" id="e12" name="emotion" value="[::心配]" />
                  <label for="e12">心配</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 行動 -->
      <div class="field">
        <label>行動（実際にとった行動や態度）</label>
        <textarea
          name="action"
          rows="2"
          placeholder="行動を入力"
        ></textarea>
      </div>

      <!-- 結果 -->
      <div class="field">
        <label>結果（行動によって起こった現実の反応）</label>
        <textarea
          name="result"
          rows="2"
          placeholder="結果を入力"
        ></textarea>
      </div>

      <!-- リフレーミング -->
      <div class="field">
        <label>リフレーミング（他の見方があるとしたら？）</label>
        <textarea
          name="reframe"
          rows="2"
          placeholder="リフレーミングを入力"
        ></textarea>
      </div>

      <!-- 送信 -->
      <button type="submit" class="ui primary button fluid">
        送信
      </button>
    </form>
  </div>

  <!-- jQuery + Semantic UI JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
  <script>
    // Semantic UI checkbox init
    $('.ui.checkbox').checkbox();

    // form submit handler
    document.getElementById('cbt-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const now = new Date();
      const date = now.getFullYear() + '/' +
        String(now.getMonth()+1).padStart(2,'0') + '/' +
        String(now.getDate()).padStart(2,'0');
      const title   = encodeURIComponent(date + '：CBT');
      const project = 'creategames';
      const emotions = Array.from(
        this.querySelectorAll('input[name="emotion"]:checked')
      ).map(cb => cb.value).join(' ');
      const lines = [
        date + '：CBT',
        '#' + date.slice(0,7),
        '',
        '[- 出来事]',   this.elements.event.value,
        '',
        '[- 自動思考]', this.elements.thought.value,
        '',
        '[- 感情]',     emotions,
        '',
        '[- 行動]',    this.elements.action.value,
        '',
        '[- 結果]',    this.elements.result.value,
        '',
        '[- リフレーミング]', this.elements.reframe.value,
        '',
        '#認知行動療法（CBT） [https://chatgpt.com/c/68095f61-f448-800f-ad49-02eb955c197c?model=gpt-4o]'
      ];
      const body = encodeURIComponent(lines.join('\n'));
      window.open(`https://scrapbox.io/${project}/${title}?body=${body}`, '_blank');
    });
  </script>
</body>
</html>
